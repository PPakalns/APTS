{% extends 'master' %}

{% block header %}
  {% if group %}
    <h2>Grupas rediģēšana</h2>
    <p class="lead">{{group.name}}</p>
  {% else %}
    <h2>Grupas izveidošana</h2>
  {% endif %}
{% endblock %}

{% block content %}
  <div class="panel panel-default">
    <div class="panel-heading">{{ form_heading or "Grupas rediģēšana" }}</div>
    <div class="panel-body">

      {% if create %}
        {{ form.open({route: 'group/create_save', class:"form-horizontal"}) }}
      {% else %}
        {{ form.open({route: 'group/edit_save', params: {id: group.id}, class:"form-horizontal"}) }}
        {{ form.hidden('id', old('id') or group.id ) }}
      {% endif %}

        {{ csrfField }}

        <div class="form-group">
          {{ form.label('name', 'Grupas nosaukums', {class: 'col-md-4 control-label'}) }}
          <div class="col-md-6">
            {{ form.text('name', old('name') or group.name, {class: 'form-control'}) }}
          </div>
        </div>

        <div class="form-group">
          <div class='col-md-12'>
            {{ form.label('description', 'Informācija grupas biedriem', {class: 'control-label'}) }}
            {{ form.textarea('description', old('description') or group.description, {class: 'form-control', rows: '20'}) }}
          </div>
        </div>

        <div class="form-group">
          <div class="col-md-4 col-md-offset-8 text-right">
            <button type="button" class="btn btn-info" id="preview">Priekšstatīt</button>
            {{ form.button('Saglabāt', 'Saglabāt', {class: "btn btn-primary"}) }}
          </div>
        </div>
      {{ form.close() }}
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">Grupas paraugs</div>
    <div class="panel-body">
      <h3 id="name_preview"> {{ old('name') or group.name }} </h3>
      <hr>
      <div id="description_preview" class="tex2jax_process">
        {{ ( old('description') or group.description ) | markdown | safe }}
      </div>
    </div>
  </div>
{% endblock %}

{% block customscript %}
  <script>
    var form = document.getElementById("preview")
    form.addEventListener("click", function(){
      var data_name = $("#name").val()
      var data_description = $("#description").val() + ''

      $("#name_preview").text(data_name)
      data_description = $("#description_preview").text(data_description).text()
      $("#description_preview").html(marked(data_description))
      MathJax.Hub.Queue(["Typeset",MathJax.Hub]);

      hljs.initHighlighting.called = false;
      hljs.initHighlighting();
    })
  </script>
{% endblock %}


{% block sidebar %}
  {% if group %}
    <div class="list-group">
      <a href="{{ 'group/show' | route({id: group.id}) }}" class="list-group-item active">
        <span class="glyphicon glyphicon-user" aria-hidden="true"></span> {{group.name}}
      </a>
    </div>
  {% else %}
  <div class="list-group">
    <a href="{{ 'group/list' | route({}) }}" class="list-group-item  list-group-item-warning">
      <span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Grupu pārvaldīšana
    </a>
  </div>
  {% endif %}
{% endblock %}
