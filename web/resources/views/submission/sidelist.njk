{# DISPLAY USER SUBMISSIONS #}

{% if cUser.auth %}

  {% set Submission = use('App/Model/Submission') %}

  {% set squery = Submission.query().where('user_id', cUser.user.id) %}
  {% if assignment %}
    {% set squery = squery.where('assignment_id', assignment.id) %}
  {% endif %}
  {% yield local_submissions = squery.orderBy('submissions.id', 'desc').limit(10).fetch() %}
  {% set local_submissions = local_submissions.toJSON() %}

  {% if local_submissions %}
    <table class="table">
      <thead>
        <tr>
          <th colspan=3>
            <span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>
            {{ antl.formatMessage('messages.task_submissions') if assignment else antl.formatMessage('messages.last_submissions') }}
          </th>
        </tr>
        <tr>
          {% if not assignment %}
            <th>{{ antl.formatMessage('messages.id') }}</th>
          {% else %}
            <th>{{ antl.formatMessage('messages.time') }}</th>
          {% endif %}
          <th>{{ antl.formatMessage('messages.status') }}</th>
          <th>{{ antl.formatMessage('messages.result') }}</th>
        </tr>
      </thead>
      <tbody>
        {% for submit in local_submissions %}
          <tr>
            {% if not assignment %}
              <td>{{ submit.id }}</td>
            {% else %}
              <td>{{ submit.created_at }}</td>
            {% endif %}
            <td>
                <a href="{{ 'SubmissionController.show' | action({id: submit.id}) }}">
                    {{ submit.statusname }}
                </a>
            </td>
            <td>{{ submit.score or 0 }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}

{% endif %}
